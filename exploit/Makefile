# must use 32-bit Qt
QMAKE = /opt/Qt32/5.5/gcc/bin/qmake

all: libhkdf.so

test_cli: cli/vota
	LD_LIBRARY_PATH=. ./$<
test_gui: gui/vota
	LD_LIBRARY_PATH=. ./$<
exploit_cli: cli/vota
	cd cli && LANG=C ../exploit.py
exploit_gui: gui/vota
	cd gui && LANG=C ../exploit.py
change_string: gui/vota
	cd gui && LANG=C ../change_string.py
restore: libhkdf.so
	cp $<.orig $<
clean:
	rm -f libhkdf.so libhkdf.so.orig

cli/vota:
	$(MAKE) -C cli
gui/vota:
	$(QMAKE) gui/vota.pro -o gui/Makefile
	$(MAKE) -C gui

libhkdf.so: hkdf.cpp
	g++ -m32 -shared $< -o $@
	cp $@ $@.orig

